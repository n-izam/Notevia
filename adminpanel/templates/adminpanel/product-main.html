{% extends "adminbase.html" %}

{% load static %}

{% block title %} productlist {% endblock %}

{% block head %} <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> {% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Assuming your sidebar is on the left -->
        <!-- <nav class="col-md-2 d-none d-md-block bg-light sidebar"> -->
            <!-- Sidebar content here -->
        <!-- </nav> -->

        <main class="col-md-9 col-lg-10 px-md-4 main-content right-main">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Products</li>
                </ol>
            </nav>
            
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 mb-0">Products</h2>
                <div class="d-flex">
                <div class="input-group me-3">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search product...">
                </div>
                <a href="{% url 'add_product' %}" class="btn btn-dark">+ Add Product</a>
                </div>
            </div>
            <!-- Filter and Sort Bar -->
            <div class="card shadow-sm mb-4">
                <div class="card-body d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <span class="me-3">Filter By:</span>
                    <div class="dropdown me-2">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Product Category
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Short Note</a></li>
                        <li><a class="dropdown-item" href="#">King Size</a></li>
                        <li><a class="dropdown-item" href="#">A4 Notebook</a></li>
                    </ul>
                    </div>
                    
                    <!-- Add other dropdowns for Price and Brand similarly -->
                </div>
                <!-- <div class="d-flex align-items-center">
                    <span class="me-3">Sort:</span>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary">Price High-Low</button>
                        <button type="button" class="btn btn-outline-secondary">Price Low-High</button>
                        <button type="button" class="btn btn-outline-secondary active">Last added first</button>
                    </div>
                </div> -->
                </div>
            </div>

            
            <!-- Responsive Table Wrapper -->
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <!-- Table Head -->
                    <thead class="table-dark">
                        <tr>
                            <th scope="col" >SNO</th>
                            <th scope="col">Image</th>
                            <th scope="col">Product Name</th>
                            <th scope="col">Category</th>
                            <!-- <th scope="col">Price</th> -->
                            <th scope="col">Variants</th>
                            <th scope="col">List/Unlist</th>
                            <th scope="col">Brand Name</th>
                            <th scope="col">Offer</th>
                            <th scope="col" class="text-end">Action</th>
                        </tr>
                    </thead>
                    <!-- Table Body -->
                    <tbody>
                        <!-- Product Item 1 (Listed / "UNLIST" state) -->
                         {% for product in products %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>
                                {% for imag in product.images.all %}
                                {% if imag.is_main %}
                                <img src="{{imag.image.url}}" class="img-fluid rounded" alt="Product Image" style="max-width: 60px;">
                                {% endif %}
                                {% endfor %}
                            </td>
                            <td>{{product.name}}</td>
                            <td>{{product.category}} </td>
                            <!-- <td>Rs. 30</td> -->
                            <td>
                                <a href="{% url 'view-variant' product.id  %}" class="btn btn-sm btn-outline-secondary">View variants</a> <!-- here we wanto pass the product id also -->
                            </td>
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch"
                                     id="switch{{ product.id }}"
                                     {% if product.is_listed %} checked {% endif %}
                                      onchange="toggleStatus('{{product.id}}')">
                                      <!-- <input class="form-check-input" type="checkbox" role="switch" 
                                      id="switch{{ product.id }}" 
                                      {% if product.is_listed %} checked {% endif %}
                                      onchange="toggleStatus('{{ product.id }}')"> -->
                                    <label class="form-check-label" for="productSwitch1"></label>
                                </div>
                            </td>
                            <td>{{product.brand.name}}</td>
                            {% if product.offer %}
                            <td><div> {{product.offer.offer_percent}}% off</div>
                                <a href="{% url 'editproduct_offer' product.id %}" class="btn btn-sm " data-action="edit"><i class="fas fa-edit" class="editCategoryOffer"></i></a>
                                <a href="{% url 'remove_product_offer' product.id %}" class="btn btn-sm text-danger"><i class="fas fa-trash"></i></a>
                            </td>
                            {% else %}
                            <td><a href="{% url 'addproduct_offer' product.id %}" class="btn btn-dark btn-sm " data-action="add" >Add Offer</a></td>
                            {% endif %}
                            <td class="text-end">
                                <a href="{% url 'edit_product' product.id %}" class="btn btn-sm btn-outline-primary" aria-label="Edit"><i class="fas fa-pencil-alt"></i></a>
                                <!-- <a href="#" class="btn btn-sm btn-outline-dark" aria-label="Delete"><i class="fas fa-eye"></i></a> -->
                            </td>
                        </tr>
                        {% endfor %}

                        <!-- Product Item 2 (Unlisted / "LIST" state) -->
                        <!-- <tr>
                            <td>
                                <img src="path/to/another/image.jpg" class="img-fluid rounded" alt="Product Image" style="max-width: 60px;">
                            </td>
                            <td>NoteVia</td>
                            <td>KING SIZE</td>
                            <td>Rs. 65</td>
                            <td>
                                <a href="#" class="btn btn-sm btn-outline-secondary">View variants</a>
                            </td>
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="productSwitch2">
                                    <label class="form-check-label" for="productSwitch2"></label>
                                </div>
                            </td>
                            <td>NoteVia</td>
                            <td><button class="btn btn-dark btn-sm openOfferModal" data-action="add" >Add Offer</button></td>
                            <td class="text-end">
                                <a href="#" class="btn btn-sm btn-outline-primary" aria-label="Edit"><i class="fas fa-pencil-alt"></i></a>
                                <a href="#" class="btn btn-sm btn-outline-dark" aria-label="Delete"><i class="fas fa-eye"></i></a>
                            </td>
                        </tr> -->
                        <!-- <tr>
                            <td>
                                <img src="path/to/another/image.jpg" class="img-fluid rounded" alt="Product Image" style="max-width: 60px;">
                            </td>
                            <td>NoteVia</td>
                            <td>KING SIZE</td>
                            <td>Rs. 65</td>
                            <td>
                                <a href="#" class="btn btn-sm btn-outline-secondary">View variants</a>
                            </td>
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="productSwitch2">
                                    <label class="form-check-label" for="productSwitch2"></label>
                                </div>
                            </td>
                            <td>NoteVia</td>
                            <td><button class="btn btn-dark btn-sm openOfferModal" data-action="add" >Add Offer</button></td>
                            <td class="text-end">
                                <a href="#" class="btn btn-sm btn-outline-primary" aria-label="Edit"><i class="fas fa-pencil-alt"></i></a>
                                <a href="#" class="btn btn-sm btn-outline-dark" aria-label="Delete"><i class="fas fa-eye"></i></a>
                            </td>
                        </tr> -->
                        <!-- <tr>
                            <td>
                                <img src="path/to/another/image.jpg" class="img-fluid rounded" alt="Product Image" style="max-width: 60px;">
                            </td>
                            <td>NoteVia</td>
                            <td>KING SIZE</td>
                            <td>Rs. 65</td>
                            <td>
                                <a href="#" class="btn btn-sm btn-outline-secondary">View variants</a>
                            </td>
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="productSwitch2">
                                    <label class="form-check-label" for="productSwitch2"></label>
                                </div>
                            </td>
                            <td>NoteVia</td>
                            <td><button class="btn btn-dark btn-sm openOfferModal" data-action="add" >Add Offer</button></td>
                            <td class="text-end">
                                <a href="#" class="btn btn-sm btn-outline-primary" aria-label="Edit"><i class="fas fa-pencil-alt"></i></a>
                                <a href="#" class="btn btn-sm btn-outline-dark" aria-label="Delete"><i class="fas fa-eye"></i></a>
                            </td>
                        </tr> -->
                        <!-- Repeat this <tr> block for other products -->

                    </tbody>
                </table>
            </div>
            <!-- Repeat for other products -->
             <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-4">
                <p>Showing 1-5 from 25</p>
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <li class="page-item disabled"><a class="page-link" href="#">‹</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">›</a></li>
                    </ul>
                </nav>
            </div>
        </main>
    </div>
</div>
<!-- end here -->
{% endblock %}

{% block modal %}

<!-- The Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add the product Offer</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="offer-title">Offer Title</label>
            <input type="text" id="offer-title" name="offer-title" placeholder="Title">
          </div>
          <div class="form-group">
            <label>Discount</label>
            <div class="discount-inputs">
              <div class="discount-input">
                <input type="text" placeholder="in percentage">
                <span>%</span>
              </div>
              <span class="or">or</span>
              <div class="discount-input">
                <input type="text" placeholder="in rupees">
                <span>rs</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>Date</label>
            <div class="date-inputs">
              <div class="date-input">
                <label for="start-date">Start date</label>
                <input type="text" id="start-date" name="start-date" placeholder="mm/dd/yyyy">
                <span class="calendar-icon">&#128197;</span>
              </div>
              <span>To</span>
              <div class="date-input">
                <label for="end-date">Ending date</label>
                <input type="text" id="end-date" name="end-date" placeholder="mm/dd/yyyy">
                <span class="calendar-icon">&#128197;</span>
              </div>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-light closeModal">Cancel</button>
            <button type="submit" class="btn btn-dark" id="modalSubmitBtn">Add</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
      <!-- /The Modal for add offer -->

{% endblock %}

{% block script %}

<script>
    function toggleStatus(productId) {
      const csrfToken = '{{ csrf_token }}';
  
      axios.post(`/adminpanel/toggles-status/${productId}/`, {}, {
        headers: {
          'X-CSRFToken': csrfToken
        }
      })
      .then(response => {
        if (response.data.success) {
          const isListed = response.data.is_listed;
          console.log(`Product ${productId} is now:`, isListed ? 'Listed ✅' : 'Unlisted ❌');
        }
      })
      .catch(error => {
        console.error("Error updating status:", error);
      });
    }
  </script>

{% endblock %}