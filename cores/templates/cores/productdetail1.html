{% extends "base1.html" %}

{% load static %}

{% block title %} Shope Detail Page {{main_product.name}} {% endblock %}
<!-- {% block head %} {% endblock %} -->
{% block style %}
<style>
   /* Toast container responsiveness */
   .toast-container {
       position: fixed;
       top: 1rem;
       right: 1rem;
       z-index: 5000;
     }
 
     @media (max-width: 576px) {
       .toast-container {
           top: auto !important;
           bottom: 1rem !important;
           right: 50% !important;
           transform: translateX(50%);
           width: 90%;
       }
     }
 
     /* Base Toast Style */
     .toast {
       backdrop-filter: blur(8px);
       background: rgba(17, 17, 17, 0.85) !important; /* glassy black */
       color: #fff !important;
       border-radius: 12px !important;
       padding: 0.75rem 1rem;
       border: 1px solid rgba(255, 255, 255, 0.15) !important;
       box-shadow: 0 4px 25px rgba(0, 0, 0, 0.35);
       animation: slideFadeIn 0.5s ease-out;
     }
 
     /* Toast body text */
     .toast-body {
       font-size: 0.95rem;
       font-weight: 500;
     }
 
     /* SUCCESS */
     .toast.bg-success {
       background: rgba(0, 255, 100, 0.15) !important;
       border-left: 4px solid #00ff73 !important;
       color: #409365 !important;
     }
 
     /* ERROR */
     .toast.bg-danger {
       background: rgba(255, 0, 0, 0.15) !important;
       border-left: 4px solid #ff3b3b !important;
       color: #bb4141 !important;
     }
 
     /* WARNING */
     .toast.bg-warning {
       background: rgba(255, 193, 7, 0.15) !important;
       border-left: 4px solid #ffc107 !important;
       color: #a1842f !important;
     }
 
     /* INFO */
     .toast.bg-info {
       background: rgba(0, 200, 255, 0.15) !important;
       border-left: 4px solid #00cfff !important;
       color: #3092a8 !important;
     }
 
     /* Beautiful animation */
     @keyframes slideFadeIn {
       0% {
           opacity: 0;
           transform: translateY(20px) scale(0.95);
       }
       100% {
           opacity: 1;
           transform: translateY(0px) scale(1);
       }
     }

     /* ... Keep your existing CSS ... */

    /* Mobile Responsiveness Sizing Adjustments */
    @media (max-width: 576px) {
        .product-details-container {
            margin-top: 1rem !important;
            padding-left: 10px;
            padding-right: 10px;
        }
        .product-title {
            font-size: 1.4rem !important;
            margin-top: 15px;
        }
        .final-price {
            font-size: 1.3rem !important;
        }
        .btn-ruling {
            font-size: 0.8rem !important;
            padding: 5px 8px !important;
        }
        .breadcrumb {
            font-size: 0.8rem;
        }
        .quantity-selector {
            max-width: 130px;
        }
        /* Similar Products Specific Mobile Sizing */
        .similar-products-section h2 {
            font-size: 1.5rem !important;
        }
        .product-card .card-title {
            font-size: 0.8rem !important;
            line-height: 1.2;
        }
        .product-card .card-text {
            font-size: 0.9rem !important;
        }
        .product-card .card-body {
            padding: 10px 5px !important;
        }
        .product-card .fa-heart {
            font-size: 1rem !important;
        }
    }

    /* Ensure horizontal spacing between the 2 items in a row on mobile */
    @media (max-width: 767px) {
        .similar-products-row {
            margin-left: -5px;
            margin-right: -5px;
        }
        .similar-products-row [class*='col-'] {
            padding-left: 5px;
            padding-right: 5px;
        }
    }
</style>
{% endblock %}

{% block content %}

<div>
    <div class="product-details-container container my-5">
    
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                {% for crumb in breadcrumb %}
                    {% if forloop.last %}
                        <li class="breadcrumb-item active" aria-current="page">{{ crumb.name }}</li>
                    {% else %}
                        <li class="breadcrumb-item"><a href="{{ crumb.url }}">{{ crumb.name }}</a></li>
                    {% endif %}
                {% endfor %}
            </ol>
        </nav>
        <div class="row">
            <!-- Column 1: Product Image Gallery -->
            <div class="col-md-7">
                <!-- Main container for the product image and thumbnails -->
                <div class="d-flex">
                    <!-- Thumbnails -->
                    <div class="product-thumbnails d-flex flex-column me-3 ">
                        {% for pro_image in images %}
                        
                        <img src="{{pro_image.image.url}}" class="img-fluid mb-2 thumbnail {% if pro_image.is_main %}active {% endif %}" alt="Thumbnail {{forloop.counter}}" onclick="changeImage(this)">
                        {% endfor %}
                        <!-- <img src="https://res.cloudinary.com/dbufuuut7/image/upload/v1760154643/products/azkm4byzkqlah8tz8rhi.png" class="img-fluid mb-2 thumbnail" alt="Thumbnail 2" onclick="changeImage(this)">
                        <img src="https://res.cloudinary.com/dbufuuut7/image/upload/v1760109421/products/mq2mfnb9kgyzy52lhlg5.png" class="img-fluid thumbnail" alt="Thumbnail 3" onclick="changeImage(this)"> -->
                    </div>

                    <!-- NEW: Wrapper for main image to handle zoom -->
                    <div class="product-zoom-container">
                        <!-- Main Image Display -->
                        <div class="main-image-container position-relative">
                            {% for main_image in images %}
                            {% if main_image.is_main %}
                            <img src="{{main_image.image.url}}" id="mainProductImage" class="img-fluid" alt="Main Product Image">
                            {% endif %}
                            {% endfor %}
                            <div class="image-nav">
                                <button id="prevBtn" class="btn btn-light"><i class="fas fa-chevron-left"></i></button>
                                <button id="nextBtn" class="btn btn-light"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- Column 2: Product Information -->
            <div class="col-md-5">
                
                <h2 class="product-title">{{main_product.name}} - {{main_product.category.name}}</h2>
                
                <div class="price-section d-flex align-items-center mb-3">
                    <span class="final-price">Rs. {{main_variant.final_price}}</span>
                    {% if main_variant.discount_percent %}
                    <del class="base-price ms-2">Rs. {{main_variant.price}}</del>
                    <span class="discount-badge ms-2">{{main_variant.discount_percent}}% OFF</span>
                    {% endif %}
                </div>
                
                <div class="options-section mb-4">
                    
                    <p class="fw-bold mb-1">Ruling type: <span id="ruling-type-text">{{main_variant.name}}</span></p>

                    <div class="btn-group" role="group">
                        {% for variant in variants %}
                        <div class="border border-end mx-1">
                            <a href="?main={{variant}}" class=" btn btn-ruling {% if main_variant == variant %} active {% endif %} border-0">{{ variant.name }} <br>
                                {% if variant.stock %}
                                <span class="text-success">In stock</span>
                                {% else %}
                                <span class="text-danger">Out of stock</span>
                                {% endif %}
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div>
                    {% if main_variant.stock <= 0 %}
                    <span class="text-danger">Out of stock</span>
                    {% elif main_variant.stock < 5 %}
                    <span class="text-warning"><i class="fas fa-warning me-2"></i>Only {{ main_variant.stock }} left!</span>
                    {% endif %}
                </div>

                <form action="{% url 'add_to_cart' %}" method="POST">
                    {% csrf_token %}

                    {% if main_variant %}
                        <input type="hidden" name="main" value="{{ main_variant }}">
                        <input type="hidden" name="product" value="{{ main_variant.product.id }}">
                    {% endif %}
                    <div class="quantity-section my-4">
                        <p class="fw-bold mb-1">Quantity</p>
                        <div class="input-group quantity-selector">
                            <button class="btn btn-outline-secondary" type="button" id="minus-btn">-</button>
                            <input type="number" name="quantity" class="form-control text-center" value="1" id="quantity-input" min="1">
                            <button class="btn btn-outline-secondary" type="button" id="plus-btn">+</button>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center mb-4">
                        <button id="addToCartBtn" class="btn btn-dark btn-lg w-100 me-3" role="button" >Add to cart</button>
                        {% if main_variant.product.id in wishlist_products %}
                        <a href="{% url 'remove_from_wishlist' %}?product_id={{main_variant.product.id}}&next={{ request.path }}" class="btn btn-outline-danger wishlist-btn" type="button"><i class="fas fa-heart"></i></a>
                        {% else %}
                        <a href="{% url 'add_to_wishlist' %}?product_id={{main_variant.product.id}}&next={{ request.path }}" class="btn btn-outline-danger wishlist-btn" type="button"><i class="far fa-heart"></i></a>
                        {% endif %}
                    </div>
                </form>
    
                <div class="shipping-info">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-truck-fast me-2"></i>
                        <span>Free delivery on orders over Rs.500</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="fas fa-shield-alt me-2"></i>
                        <i class="fas fa-warning me-2"></i>
                        <span>Secure and encrypted transaction</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container my-5">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" id="productInfoTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Description</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review" type="button" role="tab" aria-controls="review" aria-selected="false">Review</button>
            </li>
        </ul>
    
        <!-- Tab Content -->
        <div class="tab-content" id="productInfoTabsContent">
            
            <!-- Description Pane -->
            <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
                <!-- <p>Papergrid Notebooks use finest quality paper in India without any compromise in quality.</p> -->
                <p>{{main_variant.product.description}}</p>
                <h6 class="fw-bold">Features</h6>
                <p>{{main_variant.description}}</p>
                <!-- <ul>
                    
                    <li>Single Colour, Matt Finish Cover.</li>
                    <li>Available in attractive colours. Pack contains assortment of different colours.</li>
                    <li>The cover design of the notebook is subject to change, it depends on stock availability.</li>
                </ul> -->
            </div>
    
            <!-- Review Pane -->
            <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                <!-- Existing Reviews -->
                <div class="row g-4">
                    {% if reviews %}
                    {% for review in reviews %}
                    <!-- Sample Review Card 1 -->
                    <div class="col-md-6">
                        <div class="review-card">
                            <div class="review-header">
                                <div class="stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.rating %}
                                            <i class="fas fa-star text-warning"></i>
                                        {% else %}
                                            <i class="far fa-star text-muted"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <!-- <div class="stars">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div> -->
                                <div class="reviewer-info">
                                    <strong>{{review.user.full_name}}.</strong>
                                    <i class="fas fa-check-circle verified-icon"></i>
                                </div>
                                <!-- <a href="#" class="options-icon"><i class="fas fa-ellipsis-h"></i></a> -->
                            </div>
                            <p class="review-text">{{review.comment}}</p>
                            <p class="review-date">Posted on {{review.updated_at|date:"j F Y" }}</p>
                        </div>
                    </div>
                    {% endfor %}
                    <!-- Sample Review Card 2 -->
                    <!-- <div class="col-md-6">
                        <div class="review-card">
                            <div class="review-header">
                                <div class="stars">
                                   <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div>
                                <div class="reviewer-info">
                                    <strong>Samantha D.</strong>
                                    <i class="fas fa-check-circle verified-icon"></i>
                                </div>
                                <a href="#" class="options-icon"><i class="fas fa-ellipsis-h"></i></a>
                            </div>
                            <p class="review-text">Stylish and reliable, this watch blends elegance with functionality. Its sleek design, comfortable fit, and precise timekeeping make it a perfect choice for everyday use or special occasions.</p>
                            <p class="review-date">Posted on August 14, 2025</p>
                        </div>
                    </div> -->
                    <!-- Add more review cards as needed -->
                     {% else %}
                     <div class="col-md-6">
                        <div class="review-card">
                            
                            <p class="review-text text-muted">üõçÔ∏è No customer reviews yet.</p>
                            
                        </div>
                    </div>
                    {% endif %}
                </div>
    
                <!-- Write a Review Form -->
                <!-- <div class="write-review-section mt-5">
                    <hr>
                    <h3 class="fw-bold">Write a Review</h3>
                    <form>
                        <div class="mb-3">
                            <label class="form-label">What is it like to Product?</label>
                            <div class="write-review-stars">
                               <i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="reviewContent" class="form-label">Review Content</label>
                            <textarea class="form-control" id="reviewContent" rows="4" placeholder="This watch combines modern elegance with everyday practicality..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-dark">Submit Review</button>
                    </form>
                </div> -->
            </div>
        </div>
    </div>

    <div class="container my-5 py-5 similar-products-section">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Similar products</h2>
        </div>
        <!-- Added 'similar-products-row' for custom gutter control -->
        <div class="row similar-products-row">
            {% for item in product_with_image %}
            <!-- Changed to col-6 for mobile, col-md-4 for tablets, col-lg-3 for desktop -->
            <div class="col-6 col-md-4 col-lg-3 mb-4">
                <div class="card h-100 border-0 product-card gram-image-wrapper">
                    <a href="{% url 'shop_productdetail' item.product.id %}">
                        <img src="{{item.main_image.image.url}}" class="card-img-top" alt="{{ item.product.name }}">
                    </a>
                    <div class="card-body text-center">
                        <!-- Adjusted for better mobile alignment -->
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="text-start me-auto">
                                <p class="card-title mb-1">{{ item.product.name }}</p>
                                <p class="card-text fw-bold">Rs. {{ item.product.base_price }}</p>
                            </div>
                            
                            {% if item.product.id in wishlist_products %}
                            <a href="{% url 'remove_from_wishlist' %}?product_id={{item.product.id}}&next={{ request.get_full_path }}" class="text-danger" type="button"><i class="fas fa-heart"></i></a>
                            {% else %}
                            <a href="{% url 'add_to_wishlist' %}?product_id={{item.product.id}}&next={{ request.get_full_path }}" class="text-danger" type="button"><i class="far fa-heart"></i></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <!-- Toast container (fixed position) -->
    <div class="toast-container">
        {% if messages %}
            {% for message in messages %}
                <div class="toast align-items-center border-0 mb-2
                    {% if message.tags == 'error' %} bg-danger
                    {% elif message.tags == 'success' %} bg-success 
                    {% elif message.tags == 'warning' %} bg-warning 
                    {% else %} bg-info
                    {% endif %}
                ">
                    <div class="d-flex">
                        <div class="toast-body">
                        {% if message.tags == 'error' %}<i class="bi bi-x-circle-fill me-2"></i>
                        {% elif message.tags == 'success' %}<i class="bi bi-check-circle-fill me-2"></i>
                        {% elif message.tags == 'warning' %}<i class="bi bi-exclamation-triangle-fill me-2"></i>{% endif %}
                            {{ message }}
                        </div>
                        <button type="button" class="btn-close btn-close-muted me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>

{% endblock %}

{% block script %}

<!-- <script>
    const btn = document.getElementById('addToCartBtn');
    const stock = parseInt("{{ main_variant.stock|default:0 }}", 10);
  
    if (stock <= 0) {
      btn.classList.add('disabled');
      btn.setAttribute('aria-disabled', 'true');
      btn.removeAttribute('href');
      btn.innerText = 'Out of stock';
    }

    document.addEventListener("DOMContentLoaded", () => {
        const minusBtn = document.getElementById("minus-btn");
        const plusBtn  = document.getElementById("plus-btn");
        const input    = document.getElementById("quantity-input");
        // Replace with actual stock value from server
        //const stock    = 10;  
        const stock = parseInt("{{ main_variant.stock|default:0 }}", 10);
      
        // Set the max attribute
        input.max = stock;
      
        minusBtn.addEventListener("click", () => {
          let current = parseInt(input.value, 10);
          if (isNaN(current)) current = 0;
          if (current > parseInt(input.min, 10)) {
            input.value = current - 1;
          }
        });
      
        plusBtn.addEventListener("click", () => {
          let current = parseInt(input.value, 10);
          if (isNaN(current)) current = 0;
          if (current < stock) {
            input.value = current + 1;
          } else {
            // optionally show a message: ‚ÄúMax stock reached‚Äù
            input.value = stock;
          }
        });
      
        // Also handle direct input editing
        input.addEventListener("change", () => {
          let val = parseInt(input.value, 10);
          if (isNaN(val) || val < parseInt(input.min,10)) {
            input.value = input.min;
          } else if (val > stock) {
            input.value = stock;
          }
        });
      });

</script> -->
<script>
    const btn = document.getElementById('addToCartBtn');
    const stock = parseInt("{{ main_variant.stock|default:0 }}", 10);
  
    if (stock <= 0) {
      btn.classList.add('disabled');
      btn.setAttribute('aria-disabled', 'true');
      btn.removeAttribute('href');
      btn.innerText = 'Out of stock';
    }

    document.addEventListener("DOMContentLoaded", () => {
      const container = document.querySelector(".quantity-selector");
      if (!container) return;
    
      const minusBtn = container.querySelector("#minus-btn");
      const plusBtn  = container.querySelector("#plus-btn");
      const input    = container.querySelector("#quantity-input");
      const stock    = parseInt("{{ main_variant.stock|default:0 }}", 10) || 0;
    
      input.max = stock;
      input.min = 1;
    
      // Clone to remove any prior listeners
      const cleanMinus = minusBtn.cloneNode(true);
      const cleanPlus = plusBtn.cloneNode(true);
      minusBtn.replaceWith(cleanMinus);
      plusBtn.replaceWith(cleanPlus);
    
      cleanMinus.addEventListener("click", () => {
        let val = parseInt(input.value, 10);
        if (isNaN(val) || val <= 1) input.value = 1;
        else input.value = val - 1;
      });
    
      cleanPlus.addEventListener("click", () => {
        let val = parseInt(input.value, 10);
        if (isNaN(val)) val = 1;
        if (val >= stock) input.value = stock;
        else input.value = val + 1;
      });
    
      input.addEventListener("change", () => {
        let val = parseInt(input.value, 10);
        if (isNaN(val) || val < 1) input.value = 1;
        else if (val > stock) input.value = stock;
        else input.value = val;
      });
    });
    </script>
    <script>

        //document.addEventListener('DOMContentLoaded', function () {
        //var toastElList = [].slice.call(document.querySelectorAll('.toast'));
        //toastElList.map(function (toastEl) {
            //var t = new bootstrap.Toast(toastEl);
            //t.show();
        //});
    //});
    
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.toast').forEach(el => {
                new bootstrap.Toast(el).show();
            });
        });
    
        
    </script>
    <script>
        // this is a reload script
    
        window.addEventListener("pageshow", function(event) {
            //If the page is loaded from the browser's back/forward cache
            if (event.persisted) {
                window.location.reload();
            }
        });
    </script>
  

{% endblock %}